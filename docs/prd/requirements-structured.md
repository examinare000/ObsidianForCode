# ObsidianForCode 要件定義書

## 1. プロジェクト概要

**プロダクト名**: ObsidianForCode  
**目的**: VS Code上でObsidianの基本機能を提供する拡張機能  
**対象環境**: VS Code Desktop（Windows/Mac/Linux、Remote/WSL/Dev Containers対応）

## 2. 機能要件

### 2.1 MVP機能

#### 2.1.1 Wikiリンク機能 🔗
| 要件ID | 機能 | 詳細 | 優先度 |
|--------|------|------|--------|
| F001 | Wikiリンク認識 | `[[...]]` 形式をリンクとして認識・表示 | 高 |
| F002 | リンクナビゲーション | クリック/Ctrl+Enterでファイルジャンプ | 高 |
| F003 | 未存在ファイル作成 | 存在しないリンクから自動でファイル作成 | 高 |
| F004 | 別名リンク対応 | `[[Page\|表示名]]` 形式の解釈 | 中 |
| F005 | 見出しリンク対応 | `[[Page#Heading]]` 形式の解釈 | 中 |
| F006 | コンテキスト制御 | Wikiリンク内でのみキーバインド有効化 | 高 |

#### 2.1.2 Markdownプレビュー機能 📖
| 要件ID | 機能 | 詳細 | 優先度 |
|--------|------|------|--------|
| F007 | 基本Markdown描画 | 太字、チェックリスト、標準リンクの描画 | 高 |
| F008 | Wikiリンク描画 | `[[...]]` リンクをプレビューに表示 | 高 |
| F009 | プレビュー⇄エディタ連携 | プレビューからエディタ位置へジャンプ | 中 |
| F010 | 軽量実装 | 複雑な描画は行わず軽量に実装 | 高 |

#### 2.1.3 日時挿入機能 📅
| 要件ID | 機能 | 詳細 | 優先度 |
|--------|------|------|--------|
| F011 | 日付挿入 | Alt+D でカーソル位置に日付挿入 | 中 |
| F012 | 時刻挿入 | Alt+T でカーソル位置に時刻挿入 | 中 |
| F013 | フォーマット設定 | 日付・時刻フォーマットの設定可能 | 低 |

### 2.2 設定機能
| 要件ID | 設定項目 | デフォルト値 | 説明 |
|--------|----------|--------------|------|
| F014 | obsd.vaultRoot | ワークスペースルート | Vaultのルートディレクトリ |
| F015 | obsd.noteExtension | .md | ノートファイルの拡張子 |
| F016 | obsd.slugStrategy | passthrough | ファイル名変換方式 |
| F017 | obsd.dateFormat | YYYY-MM-DD | 日付挿入フォーマット |
| F018 | obsd.timeFormat | HH:mm | 時刻挿入フォーマット |
| F019 | obsd.template | 空文字 | 新規ノートテンプレート |

## 3. 技術要件

### 3.1 アーキテクチャ要件
| 要件ID | 項目 | 技術選択 | 理由 |
|--------|------|----------|------|
| T001 | 拡張機能フレームワーク | VS Code Extension API | 対象プラットフォーム |
| T002 | ファイル操作 | workspace.fs | Remote環境対応 |
| T003 | Markdownパーサー | markdown-it + wikilinks plugin | 拡張性・軽量性 |
| T004 | プレビュー表示 | VS Code Webview API | セキュリティ・統合性 |

### 3.2 実装要件
| 要件ID | コンポーネント | 実装方式 | 詳細 |
|--------|----------------|----------|------|
| T005 | DocumentLinkProvider | VS Code API | `[[...]]` のリンク化 |
| T006 | コマンド登録 | package.json contributes | 各種コマンドの定義 |
| T007 | キーバインド | when句使用 | コンテキスト制御 |
| T008 | 設定管理 | VS Code Configuration | 設定値の永続化 |

## 4. 非機能要件

### 4.1 パフォーマンス要件
- **起動時間**: 拡張機能アクティベーション < 500ms
- **リンク解析**: 大きなファイル（>1MB）でも遅延なし
- **プレビュー描画**: < 100ms
- **ファイル作成・移動**: 体感的に瞬時

### 4.2 互換性要件
- **プラットフォーム**: Windows 10+、macOS 10.15+、Linux（主要ディストリビューション）
- **VS Code**: 最新版 + 過去2メジャーバージョン
- **Remote環境**: WSL、SSH Remote、Dev Containers

### 4.3 ユーザビリティ要件
- **学習コスト**: Obsidianユーザーが迷わず使用可能
- **操作性**: キーボードショートカットでの高速操作
- **フィードバック**: 操作結果の明確な視覚的フィードバック

## 5. 受け入れ基準（DoD）

### 5.1 機能テスト
- [ ] **F001-F006**: Wikiリンク機能の完全動作
  - [ ] `[[New Note]]` でCtrl+Enterによりファイル作成・エディタ表示
  - [ ] 既存 `[[Existing]]` でクリック/Ctrl+Enterによりジャンプ
  - [ ] `[[Page|表示名]]`、`[[Page#Heading]]` の正常解決
  
- [ ] **F007-F010**: プレビュー機能の正常動作
  - [ ] 太字、チェックリスト、標準リンク、Wikiリンクの描画
  - [ ] プレビュークリックでエディタ位置ジャンプ
  
- [ ] **F011-F013**: 日時挿入機能
  - [ ] Alt+D/Alt+T による正常な日時挿入

### 5.2 環境テスト
- [ ] **ローカル環境**: Windows/Mac/Linuxでの動作確認
- [ ] **Remote環境**: WSL、SSH Remote、Dev Containersでの動作確認

### 5.3 パフォーマンステスト
- [ ] 大きなファイル（1MB+）での操作遅延なし
- [ ] プレビュー描画速度 < 100ms

## 6. 将来拡張（非MVP）

### 6.1 除外機能
以下は初期バージョンでは実装しない：
- グラフ表示
- プラグイン互換性
- モバイル同期
- 複雑なObsidianプラグインAPI互換
- VS Code Web版対応

### 6.2 将来検討事項
- DailyNote作成機能
- ToDo管理機能
- 高度なMarkdown描画
- テーマ対応

---

**文書バージョン**: 1.0  
**最終更新**: 2025-09-09  
**承認者**: [承認者名]